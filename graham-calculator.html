<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>æ ¼é›·å„å§†é‡åŒ–è®¡ç®—å™¨ 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;700&family=JetBrains+Mono:wght@300;400;500&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #07090c;
  --s1: #0d1117;
  --s2: #141a23;
  --s3: #1c2433;
  --border: #222d3d;
  --border2: #2d3d52;
  --gold: #d4a843;
  --gold2: #f0c96a;
  --gold-dim: rgba(212,168,67,0.1);
  --green: #22c55e;
  --green2: #4ade80;
  --yellow: #eab308;
  --orange: #f97316;
  --red: #ef4444;
  --blue: #3b82f6;
  --teal: #14b8a6;
  --purple: #a855f7;
  --text: #cbd5e1;
  --text2: #94a3b8;
  --muted: #475569;
  --mono: 'JetBrains Mono', monospace;
  --serif: 'Noto Serif SC', serif;
  --display: 'Oswald', sans-serif;
  --tc: #d4a843;
  --tr: 212,168,67;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:var(--serif);min-height:100vh;overflow-x:hidden;}

.header{background:linear-gradient(135deg,#0d1117,#111820);border-bottom:1px solid #2d3d52;padding:14px 16px 12px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:200;}
.header-badge{background:rgba(212,168,67,0.1);border:1px solid rgba(212,168,67,0.3);padding:4px 8px;font-family:var(--display);font-size:18px;color:var(--gold2);letter-spacing:2px;flex-shrink:0;}
.header-text h1{font-family:var(--display);font-size:16px;color:var(--gold2);letter-spacing:3px;}
.header-text p{font-family:var(--mono);font-size:10px;color:var(--muted);letter-spacing:1px;margin-top:2px;}
.header-ver{margin-left:auto;font-family:var(--mono);font-size:10px;color:var(--muted);background:var(--s2);border:1px solid var(--border);padding:3px 8px;border-radius:2px;}
.back-link{display:inline-flex;align-items:center;font-family:var(--mono);font-size:13px;color:var(--muted);text-decoration:none;transition:color 0.2s;flex-shrink:0;}
.back-link:hover{color:var(--gold);}

.type-bar{background:var(--s1);border-bottom:1px solid var(--border);padding:10px 12px;overflow-x:auto;scrollbar-width:none;position:sticky;top:57px;z-index:199;}
.type-bar::-webkit-scrollbar{display:none;}
.type-row{display:flex;gap:6px;min-width:max-content;}
.type-btn{padding:6px 12px;border-radius:3px;font-family:var(--mono);font-size:11px;border:1px solid var(--border2);background:var(--s2);color:var(--text2);cursor:pointer;transition:all 0.2s;white-space:nowrap;display:flex;flex-direction:column;align-items:center;gap:2px;}
.type-btn .ti{font-size:15px;}
.type-btn .tn{font-size:10px;letter-spacing:0.5px;}
.type-btn .tr{font-size:9px;color:var(--muted);}
.type-btn.active{border-color:var(--tc);background:rgba(var(--tr),0.08);color:var(--tc);}

.tab-nav{display:flex;background:var(--s1);border-bottom:1px solid var(--border);overflow-x:auto;scrollbar-width:none;position:sticky;top:112px;z-index:198;}
.tab-nav::-webkit-scrollbar{display:none;}
.tab-btn{flex-shrink:0;padding:9px 14px;font-size:11px;font-family:var(--mono);color:var(--muted);background:none;border:none;border-bottom:2px solid transparent;cursor:pointer;letter-spacing:0.5px;transition:all 0.2s;white-space:nowrap;}
.tab-btn.active{color:var(--gold2);border-bottom-color:var(--gold);}

.tc{display:none;padding:14px 12px 80px;}
.tc.active{display:block;}

.card{background:var(--s1);border:1px solid var(--border);border-radius:4px;padding:14px;margin-bottom:12px;position:relative;overflow:hidden;}
.ca{position:absolute;left:0;top:0;width:2px;height:100%;background:var(--tc);}
.ct{font-family:var(--display);font-size:13px;color:var(--text2);letter-spacing:2px;margin-bottom:12px;padding-left:10px;display:flex;align-items:center;gap:8px;}
.ctm{color:var(--text);}

.ig{margin-bottom:10px;}
label{display:block;font-size:10px;color:var(--muted);font-family:var(--mono);letter-spacing:1px;margin-bottom:4px;}
input[type=number],input[type=text],textarea,select{width:100%;background:var(--s2);border:1px solid var(--border2);border-radius:3px;padding:9px 11px;color:var(--text);font-family:var(--mono);font-size:13px;outline:none;transition:border-color 0.2s;-webkit-appearance:none;appearance:none;}
input:focus,textarea:focus,select:focus{border-color:var(--tc);box-shadow:0 0 0 2px rgba(var(--tr),0.08);}
textarea{resize:vertical;min-height:130px;font-size:12px;line-height:1.7;}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}

.info-box{background:rgba(0,0,0,0.3);border:1px solid var(--border);border-radius:3px;padding:10px 12px;margin-bottom:10px;font-family:var(--mono);font-size:11px;color:var(--text2);line-height:1.8;}
.info-box strong{color:var(--gold);font-weight:500;}

.type-info{background:rgba(var(--tr),0.04);border:1px solid rgba(var(--tr),0.15);border-radius:4px;padding:12px;margin-bottom:12px;}
.ti-head{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.ti-icon{font-size:20px;}
.ti-title{font-family:var(--display);font-size:14px;color:var(--tc);letter-spacing:1px;}
.ti-body{font-family:var(--mono);font-size:11px;color:var(--text2);line-height:1.8;}
.tchip{display:inline-block;padding:2px 8px;border-radius:2px;font-size:10px;font-family:var(--mono);margin:2px 3px 2px 0;background:rgba(var(--tr),0.1);border:1px solid rgba(var(--tr),0.25);color:var(--tc);}

.ck-row{display:flex;justify-content:space-between;align-items:flex-start;padding:7px 0;border-bottom:1px solid rgba(34,45,61,0.6);gap:8px;}
.ck-row:last-child{border-bottom:none;}
.ck-left{flex:1;}
.ck-label{font-size:11px;color:var(--text2);font-family:var(--mono);}
.ck-hint{font-size:10px;color:var(--muted);}
.ck-bar-wrap{height:3px;background:var(--border);border-radius:2px;margin-top:4px;overflow:hidden;}
.ck-bar{height:100%;border-radius:2px;transition:width 0.4s;}
.ck-right{text-align:right;flex-shrink:0;padding-left:8px;}
.ck-val{font-size:12px;font-family:var(--mono);}
.ck-note{font-size:9px;color:var(--muted);font-family:var(--mono);margin-top:2px;}

.sw{display:flex;align-items:center;gap:14px;padding:12px 0 8px;}
.sr{width:64px;height:64px;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;border:3px solid var(--border2);flex-shrink:0;}
.sn{font-family:var(--display);font-size:22px;line-height:1;}
.sd{font-size:9px;color:var(--muted);font-family:var(--mono);}
.si{flex:1;}
.sg{font-family:var(--display);font-size:20px;letter-spacing:2px;}
.ss{font-size:11px;color:var(--text2);font-family:var(--mono);margin-top:3px;line-height:1.5;}

.eps-add{display:flex;gap:7px;align-items:flex-end;margin-bottom:8px;}
.eps-add .ig{flex:1;margin-bottom:0;}
.eps-list{list-style:none;margin:8px 0;}
.eps-item{display:flex;align-items:center;gap:8px;padding:6px 8px;background:var(--s2);border-radius:3px;margin-bottom:5px;font-family:var(--mono);font-size:13px;}
.eps-yr{font-size:10px;color:var(--muted);width:36px;flex-shrink:0;}
.eps-bw{flex:1;height:4px;background:var(--border);border-radius:2px;overflow:hidden;}
.eps-b{height:100%;border-radius:2px;}
.eps-v{color:var(--gold2);width:52px;text-align:right;flex-shrink:0;}
.eps-del{background:none;border:none;color:var(--muted);cursor:pointer;font-size:14px;padding:0 2px;}

.rs{background:rgba(var(--tr),0.03);border:1px solid rgba(var(--tr),0.15);border-radius:4px;padding:12px;margin-top:10px;}
.rg2{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;}
.rg3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:8px;}
.ri{background:var(--s2);border-radius:3px;padding:9px;text-align:center;}
.rl{font-size:9px;color:var(--muted);font-family:var(--mono);letter-spacing:0.5px;}
.rv{font-size:16px;color:var(--gold2);font-family:var(--mono);margin-top:3px;font-weight:500;}
.rv.lg{font-size:22px;}

.badge{display:inline-flex;align-items:center;gap:4px;padding:4px 12px;border-radius:2px;font-family:var(--display);font-size:14px;letter-spacing:1px;}
.bh{background:rgba(34,197,94,0.1);color:var(--green2);border:1px solid rgba(34,197,94,0.3);}
.bm{background:rgba(234,179,8,0.1);color:var(--yellow);border:1px solid rgba(234,179,8,0.3);}
.bl{background:rgba(239,68,68,0.1);color:var(--red);border:1px solid rgba(239,68,68,0.3);}
.bn{background:rgba(71,85,105,0.2);color:var(--muted);border:1px solid rgba(71,85,105,0.3);}

.btn{background:linear-gradient(135deg,#c8953a,#a87028);color:#07090c;border:none;border-radius:3px;padding:10px 16px;font-family:var(--display);font-size:14px;letter-spacing:1.5px;cursor:pointer;width:100%;transition:all 0.2s;margin-top:4px;}
.btn:active{transform:scale(0.98);}
.bsm{padding:7px 12px;font-size:12px;width:auto;display:inline-block;}
.bgh{background:transparent;color:var(--gold);border:1px solid rgba(212,168,67,0.4);letter-spacing:1px;}

.pw{position:relative;}
.cpb{position:absolute;top:8px;right:8px;background:rgba(212,168,67,0.1);border:1px solid rgba(212,168,67,0.25);color:var(--gold);border-radius:2px;padding:4px 10px;font-size:10px;font-family:var(--mono);cursor:pointer;}

.mult-table{width:100%;font-family:var(--mono);font-size:11px;border-collapse:collapse;margin-top:8px;}
.mult-table td,.mult-table th{padding:6px 8px;border:1px solid var(--border);text-align:left;}
.mult-table th{color:var(--muted);font-size:10px;letter-spacing:1px;background:var(--s2);}
.mult-table .hl td{background:rgba(var(--tr),0.07);color:var(--tc);}

.phint{font-size:11px;color:var(--muted);font-family:var(--mono);padding:8px;background:rgba(0,0,0,0.3);border-radius:2px;margin-top:6px;line-height:1.6;}

.verdict{border-radius:4px;padding:14px;margin-top:10px;background:linear-gradient(135deg,rgba(var(--tr),0.06),rgba(0,0,0,0.2));border:1px solid rgba(var(--tr),0.2);text-align:center;}
.vg{font-family:var(--display);font-size:36px;letter-spacing:4px;line-height:1;}
.vs{font-family:var(--mono);font-size:11px;color:var(--text2);margin-top:6px;line-height:1.6;}

hr.dv{border:none;border-top:1px solid var(--border);margin:10px 0;}

.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--s3);color:var(--text);padding:9px 18px;border-radius:3px;font-size:12px;font-family:var(--mono);z-index:999;transition:transform 0.3s;border:1px solid var(--gold);white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);}
</style>
</head>
<body>

<div class="header">
  <a href="index.html" class="back-link">â†</a>
  <div class="header-badge">GV</div>
  <div class="header-text">
    <h1>æ ¼é›·å„å§†é‡åŒ–</h1>
    <p>VALUE CALCULATOR Â· Aè‚¡é€‚é…ç‰ˆ</p>
  </div>
  <div class="header-ver">2026</div>
</div>

<div class="type-bar">
  <div class="type-row" id="type-row">
    <button class="type-btn active" data-type="value" onclick="setType(this)">
      <span class="ti">ğŸ¦</span><span class="tn">ä»·å€¼/è“ç­¹</span><span class="tr">PE 10-18Ã—</span>
    </button>
    <button class="type-btn" data-type="consumer" onclick="setType(this)">
      <span class="ti">ğŸ›’</span><span class="tn">æ¶ˆè´¹/å“ç‰Œ</span><span class="tr">PE 18-28Ã—</span>
    </button>
    <button class="type-btn" data-type="tech" onclick="setType(this)">
      <span class="ti">ğŸ’»</span><span class="tn">ç§‘æŠ€/æˆé•¿</span><span class="tr">PE 25-50Ã—</span>
    </button>
    <button class="type-btn" data-type="pharma" onclick="setType(this)">
      <span class="ti">ğŸ’Š</span><span class="tn">åŒ»è¯/ç”Ÿç‰©</span><span class="tr">PE 20-35Ã—</span>
    </button>
    <button class="type-btn" data-type="cyclical" onclick="setType(this)">
      <span class="ti">âš™ï¸</span><span class="tn">å‘¨æœŸ/å·¥ä¸š</span><span class="tr">PE 6-12Ã—</span>
    </button>
    <button class="type-btn" data-type="utility" onclick="setType(this)">
      <span class="ti">âš¡</span><span class="tn">å…¬ç”¨äº‹ä¸š</span><span class="tr">PE 12-18Ã—</span>
    </button>
  </div>
</div>

<div class="tab-nav">
  <button class="tab-btn active" onclick="switchTab('input',this)">ğŸ“Š åŸºç¡€æŒ‡æ ‡</button>
  <button class="tab-btn" onclick="switchTab('eps',this)">ğŸ“ˆ EPSå‡å€¼</button>
  <button class="tab-btn" onclick="switchTab('iv',this)">ğŸ’ å†…åœ¨ä»·å€¼</button>
  <button class="tab-btn" onclick="switchTab('ncav',this)">âš–ï¸ NCAV</button>
  <button class="tab-btn" onclick="switchTab('ai',this)">ğŸ¤– AIæç¤ºè¯</button>
</div>

<!-- ===== åŸºç¡€æŒ‡æ ‡ ===== -->
<div id="tab-input" class="tc active">
  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">å½“å‰è‚¡ç¥¨ç±»å‹</span></div>
    <div class="type-info" id="type-info-panel"></div>
  </div>

  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">ä¼°å€¼æŒ‡æ ‡</span></div>
    <div class="g2">
      <div class="ig"><label>å¸‚ç›ˆç‡ P/Eï¼ˆTTMï¼‰</label><input type="number" id="pe" placeholder="å¦‚ï¼š20" step="0.1" oninput="syncAll()"></div>
      <div class="ig"><label>å¸‚å‡€ç‡ P/B</label><input type="number" id="pb" placeholder="å¦‚ï¼š2.5" step="0.01" oninput="syncAll()"></div>
      <div class="ig"><label>ROE å‡€èµ„äº§æ”¶ç›Šç‡ï¼ˆ%ï¼‰</label><input type="number" id="roe" placeholder="å¦‚ï¼š15" step="0.1" oninput="syncAll()"></div>
      <div class="ig"><label>é¢„æœŸå¹´å¢é•¿ç‡ï¼ˆ%ï¼‰</label><input type="number" id="growth" placeholder="å¦‚ï¼š12" step="0.1" oninput="syncAll()"></div>
      <div class="ig"><label>æµåŠ¨æ¯”ç‡</label><input type="number" id="cr" placeholder="å¦‚ï¼š1.8" step="0.01" oninput="syncAll()"></div>
      <div class="ig"><label>èµ„äº§è´Ÿå€ºç‡ï¼ˆ%ï¼‰</label><input type="number" id="dr" placeholder="å¦‚ï¼š45" step="0.1" oninput="syncAll()"></div>
    </div>
    <div class="ig"><label>å½“å‰è‚¡ä»·ï¼ˆå…ƒï¼‰</label><input type="number" id="stockPrice" placeholder="0.00" step="0.01" oninput="syncAll()"></div>
  </div>

  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">èµ„äº§è´Ÿå€ºæ•°æ®</span><span style="font-size:10px;color:var(--muted);font-family:var(--mono);font-weight:normal;letter-spacing:0;">ï¼ˆä¸‡å…ƒ / ä¸‡è‚¡ï¼‰</span></div>
    <div class="g2">
      <div class="ig"><label>æµåŠ¨èµ„äº§ï¼ˆä¸‡å…ƒï¼‰</label><input type="number" id="currentAssets" placeholder="0" step="1" oninput="syncAll()"></div>
      <div class="ig"><label>å…¨éƒ¨è´Ÿå€ºï¼ˆä¸‡å…ƒï¼‰</label><input type="number" id="totalLiab" placeholder="0" step="1" oninput="syncAll()"></div>
      <div class="ig"><label>æµåŠ¨è´Ÿå€ºï¼ˆä¸‡å…ƒï¼‰</label><input type="number" id="currentLiab" placeholder="0" step="1" oninput="syncAll()"></div>
      <div class="ig"><label>æ€»è‚¡æœ¬ï¼ˆä¸‡è‚¡ï¼‰</label><input type="number" id="totalShares" placeholder="0" step="1" oninput="syncAll()"></div>
    </div>
  </div>

  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">é€‰è‚¡æ ‡å‡†è¯Šæ–­</span></div>
    <div id="check-body"><div style="font-size:12px;color:var(--muted);font-family:var(--mono);padding:8px 0;">è¯·å…ˆå¡«å†™ä¸Šæ–¹æŒ‡æ ‡...</div></div>
  </div>
</div>

<!-- ===== EPSå‡å€¼ ===== -->
<div id="tab-eps" class="tc">
  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">æ¯è‚¡æ”¶ç›Š EPS å†å²æ•°æ®</span></div>
    <div class="info-box">å»ºè®®å½•å…¥ <strong>3-7å¹´</strong> EPS æ•°æ®ï¼Œå‡å€¼ç”¨äºå†…åœ¨ä»·å€¼ä¼°ç®—ã€‚<br>
      <strong>å‘¨æœŸè‚¡</strong>å»ºè®®ç”¨è·¨å‘¨æœŸå¹³å‡ï¼Œé¿å…å•å¹´é«˜ç‚¹è¯¯åˆ¤ä¼°å€¼ã€‚</div>
    <div class="eps-add">
      <div class="ig"><label>å¹´ä»½</label><input type="text" id="epsYear" placeholder="2024" style="width:70px;"></div>
      <div class="ig"><label>EPSï¼ˆå…ƒï¼‰</label><input type="number" id="epsVal" placeholder="0.000" step="0.001"></div>
      <button class="btn bgh bsm" onclick="addEPS()" style="margin-bottom:0;padding:9px 14px;">+ æ·»åŠ </button>
    </div>
    <ul class="eps-list" id="eps-list"><li style="font-size:12px;color:var(--muted);font-family:var(--mono);padding:8px 0;">æš‚æ— æ•°æ®ï¼Œè¯·æ·»åŠ EPSè®°å½•</li></ul>
    <div id="eps-result" style="display:none;">
      <hr class="dv">
      <div class="g3">
        <div class="ri"><div class="rl">EPS å‡å€¼</div><div class="rv lg" id="eps-avg">â€”</div></div>
        <div class="ri"><div class="rl">ä¸­ä½æ•°</div><div class="rv" id="eps-med">â€”</div></div>
        <div class="ri"><div class="rl">æ ‡å‡†å·®</div><div class="rv" id="eps-std">â€”</div></div>
      </div>
      <div class="rg2">
        <div class="ri"><div class="rl">æœ€é«˜å€¼</div><div class="rv" id="eps-max">â€”</div></div>
        <div class="ri"><div class="rl">æœ€ä½å€¼</div><div class="rv" id="eps-min">â€”</div></div>
      </div>
      <div class="phint" id="eps-stability" style="margin-top:8px;"></div>
    </div>
  </div>
</div>

<!-- ===== å†…åœ¨ä»·å€¼ ===== -->
<div id="tab-iv" class="tc">
  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">ä¼°å€¼å€æ•°å‚è€ƒè¡¨</span></div>
    <div class="info-box">
      æ ¼é›·å„å§†åŸå§‹ï¼ˆ1962å¹´ï¼‰ï¼š<strong>IV = EPS Ã— (8.5 + 2g)</strong>ï¼Œå½“æ—¶æ— é£é™©åˆ©ç‡çº¦4.4%<br>
      2026å¹´åå¹´å›½å€ºçº¦ <strong>2.3%</strong>ï¼Œä½åˆ©ç‡ç¯å¢ƒä¸‹åˆç†å€æ•°ç³»ç»Ÿæ€§ä¸Šç§»ï¼Œä¸”ä¸åŒè¡Œä¸šå·®å¼‚æ˜¾è‘—ã€‚
    </div>
    <table class="mult-table" id="mult-table"></table>
  </div>

  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">å†…åœ¨ä»·å€¼è®¡ç®—</span></div>
    <div class="ig"><label>EPS å‡å€¼ï¼ˆå…ƒï¼‰â€” è‡ªåŠ¨è¯»å–ï¼Œå¯æ‰‹åŠ¨è¦†ç›–</label>
      <input type="number" id="ivEps" placeholder="ä»EPSè®¡ç®—å™¨è·å–" step="0.001" oninput="calcIV()"></div>
    <div class="ig"><label id="iv-mult-label">ä¼°å€¼å€æ•°</label>
      <input type="number" id="ivMult" step="0.5" oninput="calcIV()"></div>
    <div class="phint" id="iv-mult-hint"></div>
    <hr class="dv">
    <div class="ig"><label>å½“å‰è‚¡ä»·ï¼ˆå…ƒï¼‰â€” è‡ªåŠ¨è¯»å–ï¼Œå¯æ‰‹åŠ¨è¦†ç›–</label>
      <input type="number" id="ivPrice" placeholder="å…ƒ" step="0.01" oninput="calcIV()"></div>
    <div class="ig"><label>å®‰å…¨è¾¹é™…è¦æ±‚ï¼ˆ%ï¼Œé»˜è®¤30%ï¼‰</label>
      <input type="number" id="ivMargin" value="30" step="5" min="0" max="60" oninput="calcIV()"></div>

    <div id="iv-result" class="rs" style="display:none;">
      <div class="g3">
        <div class="ri"><div class="rl">å†…åœ¨ä»·å€¼</div><div class="rv lg" id="iv-value">â€”</div></div>
        <div class="ri"><div class="rl">å®‰å…¨ä»·æ ¼çº¿</div><div class="rv" id="iv-safe">â€”</div></div>
        <div class="ri"><div class="rl">æº¢æŠ˜ä»·</div><div class="rv" id="iv-disc">â€”</div></div>
      </div>
      <div style="text-align:center;margin-top:12px;">
        <div style="font-size:10px;color:var(--muted);font-family:var(--mono);margin-bottom:6px;">å†…åœ¨ä»·å€¼â‘ åˆ¤æ–­</div>
        <div id="iv-badge"></div>
        <div id="iv-detail" style="font-size:11px;color:var(--text2);font-family:var(--mono);margin-top:6px;line-height:1.6;"></div>
      </div>
    </div>
    <div class="phint" id="peg-box" style="display:none;margin-top:8px;"></div>
  </div>
</div>

<!-- ===== NCAV ===== -->
<div id="tab-ncav" class="tc">
  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">NCAV å‡€æµåŠ¨èµ„äº§ä»·å€¼</span></div>
    <div class="info-box">
      <strong>NCAV = æµåŠ¨èµ„äº§ - å…¨éƒ¨è´Ÿå€º</strong>ï¼ˆæ ¼é›·å„å§†æ¸…ç®—åº•ä»·ï¼‰<br>
      <strong>æ¯è‚¡NCAV = (æµåŠ¨èµ„äº§ - æµåŠ¨è´Ÿå€º) Ã· æ€»è‚¡æœ¬</strong><br>
      å»‰ä»·çº¿ï¼šè‚¡ä»· &lt; æ¯è‚¡NCAV Ã— 2/3<br><br>
      âš ï¸ å½“å‰ç±»å‹ <strong id="ncav-type-hint"></strong>ï¼ŒNCAVç­–ç•¥å‚è€ƒæƒé‡å·²åœ¨ç»¼åˆè¯„çº§ä¸­è°ƒæ•´ã€‚
    </div>
    <div class="g2">
      <div class="ig"><label>æµåŠ¨èµ„äº§ï¼ˆä¸‡å…ƒï¼‰</label><input type="number" id="n-ca" step="1" oninput="calcNCAV()"></div>
      <div class="ig"><label>å…¨éƒ¨è´Ÿå€ºï¼ˆä¸‡å…ƒï¼‰</label><input type="number" id="n-tl" step="1" oninput="calcNCAV()"></div>
      <div class="ig"><label>æµåŠ¨è´Ÿå€ºï¼ˆä¸‡å…ƒï¼‰</label><input type="number" id="n-cl" step="1" oninput="calcNCAV()"></div>
      <div class="ig"><label>æ€»è‚¡æœ¬ï¼ˆä¸‡è‚¡ï¼‰</label><input type="number" id="n-ts" step="1" oninput="calcNCAV()"></div>
    </div>
    <div class="ig"><label>å½“å‰è‚¡ä»·ï¼ˆå…ƒï¼‰</label><input type="number" id="n-price" step="0.01" oninput="calcNCAV()"></div>

    <div id="ncav-result" style="display:none;">
      <hr class="dv">
      <div class="rg2">
        <div class="ri"><div class="rl">NCAVæ€»å€¼ï¼ˆä¸‡å…ƒï¼‰</div><div class="rv" id="n-ncav">â€”</div></div>
        <div class="ri"><div class="rl">æ¯è‚¡NCAVï¼ˆå…ƒï¼‰</div><div class="rv" id="n-per">â€”</div></div>
        <div class="ri"><div class="rl">2/3 NCAVçº¿ï¼ˆå…ƒï¼‰</div><div class="rv" id="n-23">â€”</div></div>
        <div class="ri"><div class="rl">è‚¡ä»·/æ¯è‚¡NCAV</div><div class="rv" id="n-ratio">â€”</div></div>
      </div>
      <hr class="dv">
      <div class="g2">
        <div style="text-align:center;">
          <div style="font-size:10px;color:var(--muted);font-family:var(--mono);margin-bottom:6px;">å†…åœ¨ä»·å€¼â‘¡<br><span style="font-size:9px;">NCAVæ¸…ç®—æ³•</span></div>
          <div id="n-badge2"></div>
          <div id="n-detail2" style="font-size:10px;color:var(--text2);font-family:var(--mono);margin-top:5px;line-height:1.5;"></div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:10px;color:var(--muted);font-family:var(--mono);margin-bottom:6px;">å†…åœ¨ä»·å€¼â‘¢<br><span style="font-size:9px;">æ¯è‚¡NCAVæ³•</span></div>
          <div id="n-badge3"></div>
          <div id="n-detail3" style="font-size:10px;color:var(--text2);font-family:var(--mono);margin-top:5px;line-height:1.5;"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card" id="verdict-card" style="display:none;"><div class="ca"></div>
    <div class="ct"><span class="ctm">ç»¼åˆä»·å€¼è¯„çº§</span></div>
    <div class="verdict">
      <div class="vg" id="v-grade">â€”</div>
      <div class="vs" id="v-sub"></div>
    </div>
    <div id="v-details" style="margin-top:12px;font-family:var(--mono);font-size:11px;color:var(--text2);line-height:1.8;"></div>
  </div>
</div>

<!-- ===== AIæç¤ºè¯ ===== -->
<div id="tab-ai" class="tc">
  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">AI é€‰è‚¡æç¤ºè¯ç”Ÿæˆ</span></div>
    <div class="info-box"><strong>åªå¡«å†™ä½ å…³æ³¨çš„æŒ‡æ ‡</strong>ï¼Œæœªå¡«å†™çš„å­—æ®µä¸ä¼šå‡ºç°åœ¨æç¤ºè¯ä¸­ã€‚<br>
      é€‚ç”¨ï¼šåŒèŠ±é¡ºé—®è´¢ Â· ä¸œæ–¹è´¢å¯ŒAI Â· é€šè¾¾ä¿¡AI</div>

    <div class="ig"><label>ç›®æ ‡è¡Œä¸š/æ¿å—ï¼ˆå¯é€‰ï¼‰</label>
      <input type="text" id="ai-sector" placeholder="å¦‚ï¼šåŠå¯¼ä½“  æ¶ˆè´¹  åŒ»è¯  ç•™ç©ºåˆ™å…¨å¸‚åœº" oninput="genPrompt()"></div>
    <div class="g2">
      <div class="ig"><label>PE â‰¤ï¼ˆå€ï¼‰</label><input type="number" id="ai-pe" step="0.5" placeholder="ä¸é™" oninput="genPrompt()"></div>
      <div class="ig"><label>PB â‰¤ï¼ˆå€ï¼‰</label><input type="number" id="ai-pb" step="0.1" placeholder="ä¸é™" oninput="genPrompt()"></div>
      <div class="ig"><label>PEÃ—PB â‰¤</label><input type="number" id="ai-pepb" step="1" placeholder="ä¸é™" oninput="genPrompt()"></div>
      <div class="ig"><label>ROE â‰¥ï¼ˆ%ï¼‰</label><input type="number" id="ai-roe" step="0.5" placeholder="ä¸é™" oninput="genPrompt()"></div>
      <div class="ig"><label>æµåŠ¨æ¯”ç‡ â‰¥</label><input type="number" id="ai-cr" step="0.1" placeholder="ä¸é™" oninput="genPrompt()"></div>
      <div class="ig"><label>è´Ÿå€ºç‡ â‰¤ï¼ˆ%ï¼‰</label><input type="number" id="ai-dr" step="1" placeholder="ä¸é™" oninput="genPrompt()"></div>
      <div class="ig"><label>å¸‚å€¼ â‰¥ï¼ˆäº¿å…ƒï¼‰</label><input type="number" id="ai-mktcap" step="1" placeholder="ä¸é™" oninput="genPrompt()"></div>
      <div class="ig"><label>PEG â‰¤</label><input type="number" id="ai-peg" step="0.1" placeholder="ä¸é™" oninput="genPrompt()"></div>
    </div>
    <div class="ig"><label>å…¶ä»–è¡¥å……æ¡ä»¶</label>
      <input type="text" id="ai-extra" placeholder="å¦‚ï¼šè¿‘5å¹´è¿ç»­ç›ˆåˆ©ï¼›æ’é™¤STè‚¡ï¼›è‚¡æ¯ç‡>2%" oninput="genPrompt()"></div>
    <hr class="dv">
    <div class="ig"><label>ç”Ÿæˆçš„æç¤ºè¯ï¼ˆå¯ç›´æ¥å¤åˆ¶æˆ–ç¼–è¾‘ï¼‰</label>
      <div class="pw"><textarea id="ai-prompt" rows="12"></textarea>
        <button class="cpb" onclick="copyPrompt()">ğŸ“‹ å¤åˆ¶</button></div>
    </div>
    <button class="btn" onclick="genPrompt()">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
  </div>

  <div class="card"><div class="ca"></div>
    <div class="ct"><span class="ctm">2026 Aè‚¡å„ç±»å‹å‚è€ƒæ ‡å‡†</span></div>
    <div class="info-box">
      <strong>ğŸ¦ ä»·å€¼/è“ç­¹</strong>ã€€PE 10-18Ã— Â· PB 0.8-2.5Ã— Â· ROEâ‰¥10% Â· é«˜è‚¡æ¯<br>
      <strong>ğŸ›’ æ¶ˆè´¹/å“ç‰Œ</strong>ã€€PE 18-28Ã— Â· PB 3-8Ã— Â· ROEâ‰¥15% Â· å®šä»·æƒ<br>
      <strong>ğŸ’» ç§‘æŠ€/æˆé•¿</strong>ã€€PE 25-50Ã— Â· PEG&lt;1.5 Â· è¥æ”¶å¢é€Ÿâ‰¥20%<br>
      <strong>ğŸ’Š åŒ»è¯/ç”Ÿç‰©</strong>ã€€PE 20-35Ã— Â· PB 2-5Ã— Â· ç®¡çº¿/ç ”å‘æŠ•å…¥<br>
      <strong>âš™ï¸ å‘¨æœŸ/å·¥ä¸š</strong>ã€€PE 6-12Ã— Â· PB 0.6-1.5Ã— Â· è·¨å‘¨æœŸEPS<br>
      <strong>âš¡ å…¬ç”¨äº‹ä¸š</strong>ã€€PE 12-18Ã— Â· è‚¡æ¯ç‡â‰¥3% Â· ç¨³å®šç°é‡‘æµ<br><br>
      âš ï¸ ä¼ ç»Ÿæ ¼é›·å„å§† PEâ‰¤15ã€PBâ‰¤1.5 åœ¨2026å¹´Aè‚¡åªä¼šç­›é€‰å‡º<strong>è¡°é€€å‹/ä»·å€¼é™·é˜±</strong>ï¼Œä¸å»ºè®®ç›´æ¥å¥—ç”¨ã€‚
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const TYPES={
  value:{name:'ä»·å€¼/è“ç­¹',icon:'ğŸ¦',color:'#d4a843',rgb:'212,168,67',
    pe:{lo:8,hi:18,warn:22},pb:{lo:0.5,hi:2.5,warn:3.5},cr:{min:1.5},dr:{max:65},roe:{min:8},
    mult:{c:12,n:15,o:18},multDesc:'ç¨³å®šè“ç­¹ï¼Œä½åˆ©ç‡ä¸‹åˆç†PEåŒºé—´ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯è‚¡æ¯+ä¸šç»©ç¨³å®šæ€§',
    growth:'5-10%',growNote:'ä¸šç»©ç¨³å®šï¼Œç»å¯¹ä»·å€¼æ³•ä¸ºä¸»',pepb:30,
    desc:'é“¶è¡Œã€ä¿é™©ã€èƒ½æºã€åŸºå»ºï¼Œé‡è§†ä½PE+ä½PB+é«˜è‚¡æ¯ï¼Œä¸è¿½æ±‚é«˜å¢é€Ÿã€‚',
    chips:['ä½PE','é«˜è‚¡æ¯','ç¨³å®šROE','è½»å€ºåŠ¡'],ncavW:0.8},
  consumer:{name:'æ¶ˆè´¹/å“ç‰Œ',icon:'ğŸ›’',color:'#22c55e',rgb:'34,197,94',
    pe:{lo:18,hi:28,warn:40},pb:{lo:2,hi:8,warn:12},cr:{min:1.2},dr:{max:60},roe:{min:15},
    mult:{c:20,n:25,o:30},multDesc:'å“ç‰ŒæŠ¤åŸæ²³æ”¯æ’‘æº¢ä»·ï¼ŒROEâ‰¥15%æ˜¯é«˜PBçš„å‰æï¼Œå‚è€ƒæ¶ˆè´¹é¾™å¤´å†å²',
    growth:'8-20%',growNote:'ROICå¯æŒç»­æ€§æ˜¯æ ¸å¿ƒï¼Œå“ç‰Œ=å®šä»·æƒ',pepb:50,
    desc:'é£Ÿå“é¥®æ–™ã€ç™½é…’ã€é›¶å”®ï¼Œæ ¸å¿ƒæ˜¯å“ç‰ŒåŠ›å’ŒROEå¯æŒç»­æ€§ï¼Œå…è®¸æ›´é«˜PBã€‚',
    chips:['å“ç‰ŒæŠ¤åŸæ²³','é«˜ROE','å®šä»·æƒ','æ¶ˆè´¹å‡çº§'],ncavW:0.3},
  tech:{name:'ç§‘æŠ€/æˆé•¿',icon:'ğŸ’»',color:'#3b82f6',rgb:'59,130,246',
    pe:{lo:25,hi:50,warn:80},pb:{lo:3,hi:12,warn:20},cr:{min:1.5},dr:{max:50},roe:{min:10},
    mult:{c:28,n:35,o:45},multDesc:'æˆé•¿æº¢ä»·æ˜¾è‘—ï¼Œç»å¯¹PEæ„ä¹‰æœ‰é™ï¼ŒPEG<1.5æ˜¯æ ¸å¿ƒåˆ¤æ–­æ ‡å‡†',
    growth:'20-50%+',growNote:'PEG=PE/å¢é•¿ç‡ï¼ŒPEG<1ä½ä¼°ï¼Œ>2é«˜ä¼°é£é™©å¤§',pepb:80,
    desc:'åŠå¯¼ä½“ã€è½¯ä»¶ã€AIã€æ–°èƒ½æºï¼Œéœ€ç»“åˆPEGå’Œè¥æ”¶å¢é€Ÿï¼Œä¸èƒ½åªçœ‹PEã€‚',
    chips:['é«˜å¢é€Ÿ','æŠ€æœ¯å£å’','PEG<1.5','å¸‚å ç‡'],ncavW:0.2},
  pharma:{name:'åŒ»è¯/ç”Ÿç‰©',icon:'ğŸ’Š',color:'#a855f7',rgb:'168,85,247',
    pe:{lo:20,hi:35,warn:60},pb:{lo:2,hi:5,warn:8},cr:{min:1.5},dr:{max:55},roe:{min:10},
    mult:{c:22,n:28,o:35},multDesc:'åˆ›æ–°è¯éœ€DCFè¡¥å……ï¼Œä»¿åˆ¶è¯ç”¨ä¼ ç»Ÿä¼°å€¼ï¼Œç»†åˆ†èµ›é“å·®å¼‚æå¤§',
    growth:'10-30%',growNote:'åˆ†åˆ›æ–°è¯/ä»¿åˆ¶è¯åˆ¤æ–­ï¼Œç®¡çº¿è¿›å±•å½±å“ä¼°å€¼',pepb:55,
    desc:'åˆ¶è¯ã€ç”Ÿç‰©ç§‘æŠ€ã€åŒ»ç–—å™¨æ¢°ï¼Œä¼°å€¼å·®å¼‚æå¤§ï¼Œéœ€å…³æ³¨ç ”å‘ç®¡çº¿ã€‚',
    chips:['ç ”å‘æŠ•å…¥','ç®¡çº¿ä»·å€¼','æ”¿ç­–å£å’','è€é¾„åŒ–'],ncavW:0.4},
  cyclical:{name:'å‘¨æœŸ/å·¥ä¸š',icon:'âš™ï¸',color:'#f97316',rgb:'249,115,22',
    pe:{lo:5,hi:12,warn:18},pb:{lo:0.4,hi:1.5,warn:2.5},cr:{min:1.3},dr:{max:70},roe:{min:6},
    mult:{c:8,n:10,o:13},multDesc:'å‘¨æœŸåº•éƒ¨PEè™šé«˜æ˜¯ä¹°ç‚¹ï¼Œç”¨è·¨å‘¨æœŸEPSå‡å€¼ï¼ŒPB<1ä¸ºå®‰å…¨åŒº',
    growth:'æ³¢åŠ¨å¤§',growNote:'å‹¿ç”¨å•å¹´åˆ©æ¶¦ï¼Œä¸­å‘¨æœŸå‡å€¼EPSæ›´å¯é ',pepb:20,
    desc:'é’¢é“ã€ç…¤ç‚­ã€åŒ–å·¥ã€èˆªè¿ï¼ŒPEå—å‘¨æœŸæ³¢åŠ¨å‰§çƒˆï¼ŒPBå’Œè·¨å‘¨æœŸEPSä¸ºä¸»ã€‚',
    chips:['PB<1','ä½æˆæœ¬','å‘¨æœŸåº•éƒ¨','ä¾›ç»™ä¾§'],ncavW:1.0},
  utility:{name:'å…¬ç”¨äº‹ä¸š',icon:'âš¡',color:'#14b8a6',rgb:'20,184,166',
    pe:{lo:12,hi:18,warn:25},pb:{lo:0.8,hi:2,warn:3},cr:{min:1.0},dr:{max:75},roe:{min:8},
    mult:{c:14,n:16,o:20},multDesc:'ç±»å€ºåˆ¸èµ„äº§ï¼Œè‚¡æ¯ç‡æ˜¯æ ¸å¿ƒï¼Œä½åˆ©ç‡ç¯å¢ƒä¼°å€¼ä¸­æ¢ä¸Šç§»',
    growth:'3-8%',growNote:'é‡è‚¡æ¯ç‡>3%ï¼Œå…³æ³¨ç›‘ç®¡æ”¿ç­–å˜åŒ–',pepb:28,
    desc:'ç”µåŠ›ã€æ°´åŠ¡ã€ç‡ƒæ°”ï¼Œç°é‡‘æµç¨³å®šï¼Œè‚¡æ¯ç‡æ˜¯é¦–è¦è€ƒé‡ã€‚',
    chips:['ç¨³å®šè‚¡æ¯','ä½æ³¢åŠ¨','æ”¿ç­–ä¿éšœ','ç±»å€º'],ncavW:0.6}
};

let ct='value', epsData=[];

function gv(id){const v=parseFloat(document.getElementById(id).value);return isNaN(v)?null:v;}
function gv2(id){const v=parseFloat(document.getElementById(id).value);return isNaN(v)?null:v;}

function setType(btn){
  document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  ct=btn.dataset.type;
  const t=TYPES[ct];
  document.documentElement.style.setProperty('--tc',t.color);
  document.documentElement.style.setProperty('--tr',t.rgb);
  document.querySelectorAll('.ca').forEach(el=>el.style.background=t.color);
  renderTypeInfo();
  renderMultTable();
  updateIVMult();
  syncAll();
  document.getElementById('ncav-type-hint').textContent=t.icon+' '+t.name+'ï¼ˆNCAVæƒé‡ Ã—'+t.ncavW+'ï¼‰';
}

function renderTypeInfo(){
  const t=TYPES[ct];
  document.getElementById('type-info-panel').innerHTML=
    `<div class="ti-head"><span class="ti-icon">${t.icon}</span><span class="ti-title">${t.name}</span></div>
    <div class="ti-body">${t.desc}<br>
    å¢é€Ÿå‚è€ƒï¼š<strong style="color:var(--tc)">${t.growth}</strong> Â· ${t.growNote}<br>
    ${t.chips.map(c=>`<span class="tchip">${c}</span>`).join('')}</div>`;
}

function renderMultTable(){
  const rows=Object.entries(TYPES).map(([k,t])=>{
    const hl=k===ct?' class="hl"':'';
    return `<tr${hl}><td>${t.icon} ${t.name}</td><td>${t.mult.c}Ã—</td><td>${t.mult.n}Ã—</td><td>${t.mult.o}Ã—</td><td style="font-size:10px;color:var(--muted);">${t.multDesc.slice(0,18)}â€¦</td></tr>`;
  }).join('');
  document.getElementById('mult-table').innerHTML=
    `<tr><th>ç±»å‹</th><th>ä¿å®ˆ</th><th>ä¸­æ€§</th><th>ä¹è§‚</th><th>è¯´æ˜</th></tr>${rows}`;
}

function updateIVMult(){
  const t=TYPES[ct];
  document.getElementById('ivMult').value=t.mult.n;
  document.getElementById('iv-mult-label').textContent=`ä¼°å€¼å€æ•° â€” ${t.name}æ¨è ${t.mult.c}-${t.mult.o}Ã—`;
  document.getElementById('iv-mult-hint').innerHTML=
    `<strong>${t.name}</strong>ï¼š${t.multDesc}<br>ä¿å®ˆ ${t.mult.c}Ã— Â· ä¸­æ€§ ${t.mult.n}Ã— Â· ä¹è§‚ ${t.mult.o}Ã—`;
  calcIV();
}

function syncAll(){
  updateBasicCheck();
  const price=gv('stockPrice');
  if(price&&!document.getElementById('ivPrice').dataset.m) document.getElementById('ivPrice').value=price;
  if(price&&!document.getElementById('n-price').dataset.m) document.getElementById('n-price').value=price;
  ['currentAssets:n-ca','totalLiab:n-tl','currentLiab:n-cl','totalShares:n-ts'].forEach(p=>{
    const [src,dst]=p.split(':');
    const val=gv(src);
    if(val!==null&&!document.getElementById(dst).dataset.m) document.getElementById(dst).value=val;
  });
  if(document.getElementById('tab-ncav').classList.contains('active')) calcNCAV();
  if(document.getElementById('tab-iv').classList.contains('active')) calcIV();
  genPrompt();
}

function updateBasicCheck(){
  const t=TYPES[ct];
  const pe=gv('pe'),pb=gv('pb'),cr=gv('cr'),dr=gv('dr'),roe=gv('roe'),growth=gv('growth');
  const ca=gv('currentAssets'),tl=gv('totalLiab'),ts=gv('totalShares'),price=gv('stockPrice');
  const checks=[];

  if(pe!==null){
    const ideal=pe>=t.pe.lo&&pe<=t.pe.hi,ok=pe<t.pe.warn;
    const pct=Math.min(100,100*(t.pe.hi/Math.max(pe,0.1)));
    const note=ideal?'å¤„äºåˆç†åŒºé—´':pe<t.pe.lo?'ä½äºå‚è€ƒä¸‹é™ï¼Œæ³¨æ„ä»·å€¼é™·é˜±':pe<t.pe.warn?'ç•¥åé«˜ï¼Œéœ€å¢é€Ÿæ”¯æ’‘':'æ˜æ˜¾åè´µï¼Œå®‰å…¨è¾¹é™…ä¸è¶³';
    checks.push({label:'å¸‚ç›ˆç‡ P/E',hint:`${t.name}åˆç† ${t.pe.lo}-${t.pe.hi}Ã— Â· è­¦æˆ’>${t.pe.warn}Ã—`,val:pe.toFixed(1)+'Ã—',ok,ideal,pct,note});
  }
  if(pb!==null){
    const ideal=pb>=t.pb.lo&&pb<=t.pb.hi,ok=pb<t.pb.warn;
    const pct=Math.min(100,100*(t.pb.hi/Math.max(pb,0.01)));
    const note=ideal?'å¤„äºåˆç†åŒºé—´':pb<t.pb.lo?'ä½PBæ³¨æ„ROEæ˜¯å¦åŒæ ·ä½':pb<t.pb.warn?'ç•¥åé«˜':'æ˜æ˜¾åè´µ';
    checks.push({label:'å¸‚å‡€ç‡ P/B',hint:`${t.name}åˆç† ${t.pb.lo}-${t.pb.hi}Ã— Â· è­¦æˆ’>${t.pb.warn}Ã—`,val:pb.toFixed(2)+'Ã—',ok,ideal,pct,note});
  }
  if(pe!==null&&pb!==null){
    const pepb=pe*pb,ok=pepb<=t.pepb;
    const pct=Math.min(100,100*(t.pepb/Math.max(pepb,0.1)));
    checks.push({label:'PE Ã— PB ç»¼åˆ',hint:`${t.name}ä¸Šé™ ${t.pepb}ï¼ˆåŸæ ¼é›·å„å§†22.5å·²è¿‡æ—¶ï¼‰`,val:pepb.toFixed(1),ok,ideal:ok,pct,note:ok?'ç»¼åˆä¼°å€¼åˆç†':'ç»¼åˆä¼°å€¼åé«˜'});
  }
  if(roe!==null){
    const ok=roe>=t.roe.min,ideal=ok&&roe>=t.roe.min*1.5;
    const pct=Math.min(100,roe/30*100);
    const note=roe>=20?'ä¼˜è´¨ç›ˆåˆ©èƒ½åŠ›':ok?'è¾¾æ ‡ï¼Œå¯æ¥å—':'ç›ˆåˆ©èƒ½åŠ›åå¼±';
    checks.push({label:'ROE å‡€èµ„äº§æ”¶ç›Šç‡',hint:`${t.name}æœ€ä½ ${t.roe.min}%`,val:roe.toFixed(1)+'%',ok,ideal,pct,note});
  }
  if(cr!==null){
    const ok=cr>=t.cr.min,ideal=cr>=2;
    const pct=Math.min(100,cr/3*100);
    checks.push({label:'æµåŠ¨æ¯”ç‡',hint:`${t.name}å»ºè®®â‰¥${t.cr.min}ï¼ˆä¼ ç»Ÿ2.0æ ‡å‡†è¿‡ä¸¥ï¼‰`,val:cr.toFixed(2),ok,ideal,pct,note:cr>=2?'çŸ­æœŸå¿å€ºå®‰å…¨':ok?'åŸºæœ¬è¾¾æ ‡':'çŸ­æœŸæµåŠ¨æ€§åå¼±'});
  }
  if(dr!==null){
    const ok=dr<=t.dr.max,ideal=dr<=t.dr.max*0.7;
    const pct=Math.min(100,(1-dr/100)*100);
    checks.push({label:'èµ„äº§è´Ÿå€ºç‡',hint:`${t.name}å‚è€ƒä¸Šé™ ${t.dr.max}%`,val:dr.toFixed(1)+'%',ok,ideal,pct,note:dr<=40?'è´Ÿå€ºç»“æ„å¥åº·':ok?'å¯æ¥å—èŒƒå›´':'è´Ÿå€ºåé«˜'});
  }
  if(growth!==null&&pe!==null&&growth>0){
    const peg=pe/growth,ok=peg<=1.5,ideal=peg<=1;
    const pct=Math.min(100,(1.5/Math.max(peg,0.01))*100);
    const note=peg<1?'PEG<1å¢é€Ÿå……åˆ†æ”¯æ’‘':peg<1.5?'PEGåˆç†':peg<2?'æˆé•¿æº¢ä»·åé«˜':'å¢é€Ÿéš¾æ”¯æ’‘PE';
    checks.push({label:'PEG æˆé•¿è°ƒæ•´ä¼°å€¼',hint:'PEÃ·å¢é•¿ç‡ï¼š<1ä½ä¼° Â· 1-1.5åˆç† Â· >2åè´µ',val:peg.toFixed(2),ok,ideal,pct,note});
  }
  if(ca!==null&&tl!==null&&ts!==null&&ts>0&&price!==null){
    const ncavPS=(ca-tl)/ts,target=ncavPS*2/3,ok=price<target;
    const pct=ok?100:Math.min(100,target/Math.max(price,0.01)*100);
    const note=ok?'æ»¡è¶³æ ¼é›·å„å§†æ¸…ç®—å®‰å…¨è¾¹é™…':ncavPS>0?`é«˜å‡º2/3çº¿${((price/target-1)*100).toFixed(0)}%`:'NCAVä¸ºè´Ÿ';
    checks.push({label:'NCAVæ¸…ç®—å®‰å…¨è¾¹é™…',hint:`æ¯è‚¡NCAV:${ncavPS.toFixed(2)} Â· 2/3çº¿:${target.toFixed(2)}`,val:price.toFixed(2)+' vs '+target.toFixed(2),ok,ideal:ok,pct,note});
  }

  if(checks.length===0){
    document.getElementById('check-body').innerHTML='<div style="font-size:12px;color:var(--muted);font-family:var(--mono);padding:8px 0;">è¯·å¡«å†™ä¸Šæ–¹æŒ‡æ ‡...</div>';
    return;
  }

  const passN=checks.filter(c=>c.ok).length,idealN=checks.filter(c=>c.ideal).length,total=checks.length;
  const sc=idealN>=total*0.7?'var(--green)':passN>=total*0.6?'var(--yellow)':'var(--red)';
  const grade=idealN===total?'ä¼˜è´¨æ ‡çš„':idealN>=total*0.7?'å€¼å¾—å…³æ³¨':passN>=total*0.6?'åŸºæœ¬è¾¾æ ‡':'è°¨æ…è§‚æœ›';

  let html=`<div class="sw">
    <div class="sr" style="border-color:${sc};">
      <div class="sn" style="color:${sc};">${passN}</div>
      <div class="sd">/ ${total}</div>
    </div>
    <div class="si">
      <div class="sg" style="color:${sc};">${grade}</div>
      <div class="ss">é€šè¿‡ ${passN}/${total} é¡¹ Â· ç†æƒ³ ${idealN}/${total} é¡¹<br>${TYPES[ct].icon} ${TYPES[ct].name} ä¸“å±æ ‡å‡†</div>
    </div>
  </div><hr class="dv">`;

  html+=checks.map(c=>`
    <div class="ck-row">
      <div class="ck-left">
        <div class="ck-label"><span style="color:${c.ok?'var(--green)':'var(--red)'}">${c.ok?'âœ“':'âœ—'}</span> ${c.label}</div>
        <div class="ck-hint">${c.hint}</div>
        <div class="ck-bar-wrap"><div class="ck-bar" style="width:${c.pct}%;background:${c.ideal?'var(--green)':c.ok?'var(--yellow)':'var(--red)'};"></div></div>
      </div>
      <div class="ck-right">
        <div class="ck-val" style="color:${c.ideal?'var(--green)':c.ok?'var(--yellow)':'var(--red)'}">${c.val}</div>
        <div class="ck-note">${c.note}</div>
      </div>
    </div>`).join('');

  document.getElementById('check-body').innerHTML=html;
}

// EPS
function addEPS(){
  const year=document.getElementById('epsYear').value.trim()||(new Date().getFullYear()-epsData.length).toString();
  const val=parseFloat(document.getElementById('epsVal').value);
  if(isNaN(val)){showToast('è¯·è¾“å…¥æœ‰æ•ˆEPS');return;}
  epsData.push({id:Date.now(),year,val});
  document.getElementById('epsYear').value='';
  document.getElementById('epsVal').value='';
  renderEPS();
}
document.getElementById('epsVal').addEventListener('keydown',e=>{if(e.key==='Enter')addEPS();});

function removeEPS(id){epsData=epsData.filter(e=>e.id!==id);renderEPS();}

function renderEPS(){
  const list=document.getElementById('eps-list');
  if(!epsData.length){
    list.innerHTML='<li style="font-size:12px;color:var(--muted);font-family:var(--mono);padding:8px 0;">æš‚æ— æ•°æ®</li>';
    document.getElementById('eps-result').style.display='none';
    return;
  }
  const vals=epsData.map(e=>e.val),mx=Math.max(...vals.map(Math.abs));
  list.innerHTML=epsData.map(e=>`
    <li class="eps-item">
      <span class="eps-yr">${e.year}</span>
      <div class="eps-bw"><div class="eps-b" style="width:${Math.abs(e.val)/mx*100}%;background:${e.val<0?'var(--red)':'var(--green)'};"></div></div>
      <span class="eps-v">${e.val.toFixed(3)}</span>
      <button class="eps-del" onclick="removeEPS(${e.id})">âœ•</button>
    </li>`).join('');
  const avg=vals.reduce((a,b)=>a+b,0)/vals.length;
  const sorted=[...vals].sort((a,b)=>a-b);
  const med=sorted.length%2===0?(sorted[sorted.length/2-1]+sorted[sorted.length/2])/2:sorted[Math.floor(sorted.length/2)];
  const std=Math.sqrt(vals.map(v=>(v-avg)**2).reduce((a,b)=>a+b,0)/vals.length);
  const cv=avg?Math.abs(std/avg)*100:0;
  document.getElementById('eps-result').style.display='block';
  document.getElementById('eps-avg').textContent='Â¥'+avg.toFixed(3);
  document.getElementById('eps-med').textContent='Â¥'+med.toFixed(3);
  document.getElementById('eps-std').textContent=std.toFixed(3);
  document.getElementById('eps-max').textContent='Â¥'+Math.max(...vals).toFixed(3);
  document.getElementById('eps-min').textContent='Â¥'+Math.min(...vals).toFixed(3);
  document.getElementById('eps-stability').textContent=
    cv<15?`EPSæ³¢åŠ¨ç‡ä½ï¼ˆCV=${cv.toFixed(0)}%ï¼‰ï¼Œç›ˆåˆ©ç¨³å®šï¼Œå‡å€¼å¯é `:
    cv<40?`EPSå­˜åœ¨æ³¢åŠ¨ï¼ˆCV=${cv.toFixed(0)}%ï¼‰ï¼Œå»ºè®®ä½¿ç”¨ä¿å®ˆä¼°å€¼å€æ•°`:
    `âš ï¸ EPSæ³¢åŠ¨å‰§çƒˆï¼ˆCV=${cv.toFixed(0)}%ï¼‰ï¼Œå‘¨æœŸæ€§æ˜æ˜¾ï¼ŒåŠ¡å¿…ç”¨è·¨å‘¨æœŸå‡å€¼`;
  if(!document.getElementById('ivEps').dataset.m) document.getElementById('ivEps').value=avg.toFixed(4);
  calcIV();
}

// IV
function calcIV(){
  const eps=parseFloat(document.getElementById('ivEps').value);
  const mult=parseFloat(document.getElementById('ivMult').value);
  const price=parseFloat(document.getElementById('ivPrice').value);
  const margin=parseFloat(document.getElementById('ivMargin').value)||30;
  const res=document.getElementById('iv-result');
  if(isNaN(eps)||isNaN(mult)||isNaN(price)){res.style.display='none';return;}
  const iv=eps*mult,safe=iv*(1-margin/100),disc=(iv-price)/iv*100;
  document.getElementById('iv-value').textContent='Â¥'+iv.toFixed(2);
  document.getElementById('iv-safe').textContent='Â¥'+safe.toFixed(2);
  document.getElementById('iv-disc').textContent=(disc>0?'+':'')+disc.toFixed(1)+'%';
  document.getElementById('iv-disc').style.color=disc>0?'var(--green)':disc>-20?'var(--yellow)':'var(--red)';
  let badge,detail;
  if(price<=safe){const d=(safe-price)/safe*100;badge=d>20?'<span class="badge bh">ğŸ”¥ é«˜</span>':'<span class="badge bh">âœ… é«˜</span>';detail=`ä½äºå®‰å…¨ä»·æ ¼çº¿${d.toFixed(0)}%ï¼Œå®‰å…¨è¾¹é™…${d>20?'å……è£•':'è¾¾æ ‡'}`;}
  else if(price<iv){badge='<span class="badge bm">âš¡ ä¸­ç­‰</span>';detail=`ä½äºå†…åœ¨ä»·å€¼ä½†å®‰å…¨è¾¹é™…ä¸è¶³${margin}%`;}
  else if(price<iv*1.2){badge='<span class="badge bm">ğŸ“Š ä¸­ç­‰</span>';detail=`ç•¥é«˜äºå†…åœ¨ä»·å€¼${((price/iv-1)*100).toFixed(0)}%ï¼Œåè´µ`;}
  else{badge='<span class="badge bl">âš ï¸ ä½</span>';detail=`é«˜äºå†…åœ¨ä»·å€¼${((price/iv-1)*100).toFixed(0)}%ï¼Œå®‰å…¨è¾¹é™…ä¸¥é‡ä¸è¶³`;}
  document.getElementById('iv-badge').innerHTML=badge;
  document.getElementById('iv-detail').textContent=detail;
  res.style.display='block';
  const pegBox=document.getElementById('peg-box');
  const growth=gv('growth'),pe=gv('pe');
  if(ct==='tech'&&growth&&pe){
    const peg=pe/growth;
    pegBox.style.display='block';
    pegBox.innerHTML=`<strong>æˆé•¿è‚¡æ ¸å¿ƒï¼šPEG = ${peg.toFixed(2)}</strong>ï¼ˆPEÃ·å¢é•¿ç‡ï¼‰<br>
      ${peg<1?'âœ… PEG<1ï¼Œå¢é€Ÿå……åˆ†æ”¯æ’‘ä¼°å€¼ï¼Œæˆé•¿è‚¡é¦–é€‰ä¹°å…¥åŒºé—´':peg<1.5?'âš¡ PEGåˆç†ï¼Œéœ€å¢é€ŸæŒç»­å…‘ç°':peg<2?'âš ï¸ PEGåé«˜ï¼Œéœ€è¶…é¢„æœŸå¢é€Ÿ':'âŒ PEG>2ï¼Œä¼°å€¼éš¾ä»¥æ”¯æ’‘'}`;
  } else {pegBox.style.display='none';}
  updateVerdict();
}

// NCAV
function calcNCAV(){
  const ca=parseFloat(document.getElementById('n-ca').value);
  const tl=parseFloat(document.getElementById('n-tl').value);
  const cl=parseFloat(document.getElementById('n-cl').value);
  const ts=parseFloat(document.getElementById('n-ts').value);
  const price=parseFloat(document.getElementById('n-price').value);
  const res=document.getElementById('ncav-result');
  if(isNaN(ca)||isNaN(tl)){res.style.display='none';return;}
  const ncav=ca-tl,perShare=(!isNaN(ts)&&ts>0)?(ca-tl)/ts:null;
  const perShare2=(!isNaN(cl)&&!isNaN(ts)&&ts>0)?(ca-cl)/ts:null;
  document.getElementById('n-ncav').textContent=ncav.toFixed(0);
  document.getElementById('n-per').textContent=perShare!==null?'Â¥'+perShare.toFixed(3):'â€”';
  let b2='',d2='',b3='',d3='';
  if(!isNaN(price)&&perShare!==null){
    const t23=perShare*2/3,disc=(t23-price)/t23;
    document.getElementById('n-23').textContent='Â¥'+t23.toFixed(3);
    document.getElementById('n-ratio').textContent=(price/perShare).toFixed(2)+'Ã—';
    if(price<t23){b2=disc>0.3?'<span class="badge bh">ğŸ”¥ é«˜</span>':disc>0.1?'<span class="badge bh">âœ… é«˜</span>':'<span class="badge bm">âš¡ ä¸­ç­‰</span>';d2=`ä½äº2/3çº¿${(disc*100).toFixed(0)}%`;}
    else{const ov=(price/t23-1)*100;b2=ov<15?'<span class="badge bm">âš¡ ä¸­ç­‰</span>':'<span class="badge bl">âš ï¸ ä½</span>';d2=`é«˜äº2/3çº¿${ov.toFixed(0)}%`;}
  }else{document.getElementById('n-23').textContent='â€”';document.getElementById('n-ratio').textContent='â€”';}
  if(!isNaN(price)&&perShare2!==null){
    const r=perShare2/price;
    if(perShare2>price){b3=r>=1.5?'<span class="badge bh">ğŸ”¥ é«˜</span>':r>=1.2?'<span class="badge bh">âœ… é«˜</span>':'<span class="badge bm">âš¡ ä¸­ç­‰</span>';d3=`è¶…è‚¡ä»·${((r-1)*100).toFixed(0)}%`;}
    else if(r>=0.85){b3='<span class="badge bm">âš¡ ä¸­ç­‰</span>';d3=`æ¥è¿‘è‚¡ä»·ï¼Œå·®${((1-r)*100).toFixed(0)}%`;}
    else{b3='<span class="badge bl">âš ï¸ ä½</span>';d3=`ä½äºè‚¡ä»·${((1-r)*100).toFixed(0)}%`;}
  }
  document.getElementById('n-badge2').innerHTML=b2||'<span class="badge bn">æ•°æ®ä¸è¶³</span>';
  document.getElementById('n-detail2').textContent=d2;
  document.getElementById('n-badge3').innerHTML=b3||'<span class="badge bn">æ•°æ®ä¸è¶³</span>';
  document.getElementById('n-detail3').textContent=d3;
  res.style.display='block';
  updateVerdict();
}

function updateVerdict(){
  const b1=document.getElementById('iv-badge').innerHTML;
  const b2=document.getElementById('n-badge2').innerHTML;
  const b3=document.getElementById('n-badge3').innerHTML;
  const all=[b1,b2,b3].filter(b=>b&&!b.includes('æ•°æ®ä¸è¶³')&&b.length>5);
  const vc=document.getElementById('verdict-card');
  if(!all.length){vc.style.display='none';return;}
  const high=all.filter(b=>b.includes('bh')).length,mid=all.filter(b=>b.includes('bm')).length,n=all.length;
  let grade,sub,color;
  const t=TYPES[ct];
  if(high===n){grade='A+';color='var(--green2)';sub='å…¨ç»´åº¦é«˜ä»·å€¼ Â· æ ¼é›·å„å§†å¼ºä¹°ä¿¡å·';}
  else if(high>=n*0.6){grade='A';color='var(--green)';sub='é«˜ä»·å€¼ Â· å…·å¤‡å®‰å…¨è¾¹é™…';}
  else if(high+mid>=n*0.6){grade='B';color='var(--yellow)';sub='ä¸­ç­‰ä»·å€¼ Â· å¯è·Ÿè¸ªè§‚å¯Ÿ';}
  else{grade='C';color='var(--red)';sub='ä»·å€¼ä¸è¶³ Â· å»ºè®®è§‚æœ›';}
  document.getElementById('v-grade').textContent=grade;
  document.getElementById('v-grade').style.color=color;
  document.getElementById('v-sub').textContent=sub;
  document.getElementById('v-details').innerHTML=
    `NCAVç­–ç•¥å¯¹ <strong>${t.icon} ${t.name}</strong> çš„å‚è€ƒæƒé‡ä¸º Ã—${t.ncavW}ï¼Œ${t.ncavW<0.5?'è½»èµ„äº§è¡Œä¸šä¸å®œè¿‡åº¦ä¾èµ–NCAVåˆ¤æ–­':'é‡èµ„äº§è¡Œä¸šNCAVå…·æœ‰è¾ƒé«˜å‚è€ƒä»·å€¼'}ã€‚<br>
    ç»¼åˆè¯„çº§ç»¼åˆäº†å†…åœ¨ä»·å€¼â‘ â‘¡â‘¢ä¸‰ä¸ªç»´åº¦ï¼Œè¯·ç»“åˆè¡Œä¸šæ™¯æ°”åº¦å’Œå®šæ€§åˆ†æåšæœ€ç»ˆåˆ¤æ–­ã€‚`;
  vc.style.display='block';
}

function switchTab(name,btn){
  document.querySelectorAll('.tc').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  btn.classList.add('active');
  if(name==='iv'){
    const price=gv('stockPrice');if(price&&!document.getElementById('ivPrice').dataset.m)document.getElementById('ivPrice').value=price;
    if(epsData.length&&!document.getElementById('ivEps').dataset.m){
      const avg=epsData.map(e=>e.val).reduce((a,b)=>a+b,0)/epsData.length;
      document.getElementById('ivEps').value=avg.toFixed(4);
    }
    renderMultTable();calcIV();
  }
  if(name==='ncav'){
    ['currentAssets:n-ca','totalLiab:n-tl','currentLiab:n-cl','totalShares:n-ts'].forEach(p=>{
      const [s,d]=p.split(':');const val=gv(s);
      if(val!==null&&!document.getElementById(d).dataset.m)document.getElementById(d).value=val;
    });
    const price=gv('stockPrice');if(price&&!document.getElementById('n-price').dataset.m)document.getElementById('n-price').value=price;
    calcNCAV();
  }
  if(name==='ai')genPrompt();
}

function genPrompt(){
  const t=TYPES[ct];
  const sector=document.getElementById('ai-sector').value.trim();
  const items=[];
  const aiPE=gv2('ai-pe'),aiPB=gv2('ai-pb'),aiPEPB=gv2('ai-pepb'),aiROE=gv2('ai-roe');
  const aiCR=gv2('ai-cr'),aiDR=gv2('ai-dr'),aiCap=gv2('ai-mktcap'),aiPEG=gv2('ai-peg');
  const extra=document.getElementById('ai-extra').value.trim();
  if(aiPE!==null)items.push(`å¸‚ç›ˆç‡ï¼ˆPE/TTMï¼‰â‰¤ ${aiPE} å€`);
  if(aiPB!==null)items.push(`å¸‚å‡€ç‡ï¼ˆPBï¼‰â‰¤ ${aiPB} å€`);
  if(aiPEPB!==null)items.push(`PE Ã— PB ä¹˜ç§¯ â‰¤ ${aiPEPB}`);
  if(aiROE!==null)items.push(`å‡€èµ„äº§æ”¶ç›Šç‡ï¼ˆROEï¼‰â‰¥ ${aiROE}%`);
  if(aiCR!==null)items.push(`æµåŠ¨æ¯”ç‡ â‰¥ ${aiCR}`);
  if(aiDR!==null)items.push(`èµ„äº§è´Ÿå€ºç‡ â‰¤ ${aiDR}%`);
  if(aiCap!==null)items.push(`æ€»å¸‚å€¼ â‰¥ ${aiCap} äº¿å…ƒ`);
  if(aiPEG!==null)items.push(`PEGï¼ˆPEÃ·å¢é•¿ç‡ï¼‰â‰¤ ${aiPEG}`);
  if(!items.length){document.getElementById('ai-prompt').value='è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªç­›é€‰æŒ‡æ ‡åç”Ÿæˆæç¤ºè¯ã€‚';return;}
  const sectorLine=sector?`è¡Œä¸š/æ¿å—ï¼š${sector}`:'å…¨å¸‚åœºAè‚¡';
  document.getElementById('ai-prompt').value=
`è¯·å¸®æˆ‘ä»Aè‚¡ç­›é€‰ç¬¦åˆä»·å€¼æŠ•èµ„ç­–ç•¥çš„è‚¡ç¥¨ã€‚

ã€é€‰è‚¡èŒƒå›´ã€‘
${sectorLine}ï¼ˆå‰”é™¤STã€é‡‘èç±»ï¼‰

ã€ç­›é€‰æ¡ä»¶ã€‘
${items.map((c,i)=>`${i+1}. ${c}`).join('\n')}

ã€æ’é™¤æ¡ä»¶ã€‘
- æ’é™¤STã€*STåŠé€€å¸‚é£é™©è‚¡
- æ’é™¤è¿‘ä¸€å¹´é‡å¤§è¿è§„æˆ–è´¢åŠ¡é€ å‡è®°å½•
${extra?'- '+extra:''}
ã€ç­–ç•¥èƒŒæ™¯ã€‘
åŸºäºæ ¼é›·å„å§†ä»·å€¼æŠ•èµ„+2026å¹´Aè‚¡å¸‚åœºå‚æ•°ï¼Œé‡ç‚¹å…³æ³¨${t.icon}${t.name}ç±»æ ‡çš„ï¼Œæ ¸å¿ƒè¦æ±‚ï¼š${t.chips.join('ã€')}ã€‚

ã€è¾“å‡ºæ ¼å¼ã€‘
æŒ‰ä¼°å€¼å¸å¼•åŠ›æ’åˆ—ï¼Œæ¯è‚¡ç»™å‡ºï¼šä»£ç å’Œåç§° | æ ¸å¿ƒæŒ‡æ ‡å€¼ | æ˜¯å¦æ»¡è¶³å„æ¡ä»¶ | 1-2å¥æŠ•èµ„é€»è¾‘`;
}

function copyPrompt(){
  const text=document.getElementById('ai-prompt').value;
  if(navigator.clipboard)navigator.clipboard.writeText(text).then(()=>showToast('âœ… æç¤ºè¯å·²å¤åˆ¶'));
  else{document.getElementById('ai-prompt').select();document.execCommand('copy');showToast('âœ… å·²å¤åˆ¶');}
}

function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2200);
}

// Mark manual override for auto-sync fields
['ivPrice','ivEps','n-ca','n-tl','n-cl','n-ts','n-price'].forEach(id=>{
  const el=document.getElementById(id);
  if(el)el.addEventListener('input',()=>el.dataset.m='1');
});

// Init
setType(document.querySelector('.type-btn.active'));
</script>
</body>
</html>
